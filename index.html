<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Node/Rust</title>
  </head>
  <script src="
  https://cdn.jsdelivr.net/npm/chart.js@4.4.2/dist/chart.umd.min.js
  "></script>

  <body>
    <h1>CPU Usage %</h1>
    <div style="width: 800px">
      <canvas id="CPU" width="200px" height="100"></canvas>
    </div>
    <h1>Memory Usage MB</h1>
    <div style="width: 800px">
      <canvas id="MEM" width="200px" height="100"></canvas>
    </div>
    <h1>PORT</h1>
    <div style="width: 800px">
      <canvas id="PORT" width="200px" height="100"></canvas>
    </div>
  </body>
  <script>
    function dtoS(hms) {
      var a = hms.split(":"); // split it at the colons

      // minutes are worth 60 seconds. Hours are worth 60 minutes.
      var seconds = (+a[0] * 60 + +a[1]).toFixed() + " s";
      return seconds;
    }
    const rust = [
      {
        TIME: "00:00.23",
        CPU: "0.0",
        MEM: "1857K",
        PORT: "21",
        STATE: "sleeping",
        _5: "",
      },
      {
        TIME: "00:00.23",
        CPU: "0.0",
        MEM: "1857K",
        PORT: "21",
        STATE: "sleeping",
        _5: "",
      },
      {
        TIME: "00:04.90",
        CPU: "417.7",
        MEM: "3345K",
        PORT: "21",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "00:11.14",
        CPU: "568.5",
        MEM: "3601K",
        PORT: "21",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "00:18.58",
        CPU: "678.6",
        MEM: "3729K",
        PORT: "21",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "00:25.73",
        CPU: "634.6",
        MEM: "4097K",
        PORT: "21",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "00:32.88",
        CPU: "638.4",
        MEM: "4225K",
        PORT: "21",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "00:39.90",
        CPU: "647.2",
        MEM: "4481K",
        PORT: "21",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "00:46.89",
        CPU: "615.2",
        MEM: "5073K",
        PORT: "21",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "00:53.92",
        CPU: "646.9",
        MEM: "5505K",
        PORT: "21",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "01:01.17",
        CPU: "668.1",
        MEM: "5521K",
        PORT: "21",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "01:08.59",
        CPU: "655.1",
        MEM: "5553K",
        PORT: "21",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "01:15.72",
        CPU: "637.7",
        MEM: "5585K",
        PORT: "21",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "01:22.65",
        CPU: "635.9",
        MEM: "5681K",
        PORT: "21",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "01:29.91",
        CPU: "666.0",
        MEM: "5777K",
        PORT: "21",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "01:37.20",
        CPU: "665.8",
        MEM: "5873K",
        PORT: "21",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "01:44.12",
        CPU: "613.8",
        MEM: "5889K",
        PORT: "21",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "01:50.92",
        CPU: "610.4",
        MEM: "5921K",
        PORT: "21",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "01:58.05",
        CPU: "656.5",
        MEM: "5921K",
        PORT: "21",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "02:05.04",
        CPU: "639.3",
        MEM: "5921K",
        PORT: "21",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "02:12.19",
        CPU: "649.4",
        MEM: "5921K",
        PORT: "21",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "02:19.41",
        CPU: "646.0",
        MEM: "6017K",
        PORT: "21",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "02:26.50",
        CPU: "651.6",
        MEM: "6113K",
        PORT: "21",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "02:33.60",
        CPU: "653.2",
        MEM: "6113K",
        PORT: "21",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "02:40.66",
        CPU: "642.4",
        MEM: "6193K",
        PORT: "21",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "02:47.21",
        CPU: "596.5",
        MEM: "6193K",
        PORT: "21",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "02:53.79",
        CPU: "594.4",
        MEM: "6193K",
        PORT: "21",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "03:00.77",
        CPU: "623.0",
        MEM: "6465K",
        PORT: "21",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "03:07.54",
        CPU: "606.3",
        MEM: "6513K",
        PORT: "21",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "03:14.14",
        CPU: "589.2",
        MEM: "6561K",
        PORT: "21",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "03:20.71",
        CPU: "602.7",
        MEM: "6609K",
        PORT: "21",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "03:27.38",
        CPU: "592.0",
        MEM: "6657K",
        PORT: "21",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "03:33.66",
        CPU: "555.2",
        MEM: "6689K",
        PORT: "21",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "03:40.68",
        CPU: "643.6",
        MEM: "6689K",
        PORT: "21",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "03:47.56",
        CPU: "628.0",
        MEM: "6753K",
        PORT: "21",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "03:53.78",
        CPU: "555.7",
        MEM: "6801K",
        PORT: "21",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "04:00.48",
        CPU: "594.7",
        MEM: "6833K",
        PORT: "21",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "04:07.66",
        CPU: "640.6",
        MEM: "6865K",
        PORT: "21",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "04:14.24",
        CPU: "592.7",
        MEM: "6881K",
        PORT: "21",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "04:21.05",
        CPU: "608.8",
        MEM: "6897K",
        PORT: "21",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "04:28.10",
        CPU: "646.6",
        MEM: "6897K",
        PORT: "21",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "04:35.03",
        CPU: "625.9",
        MEM: "6929K",
        PORT: "21",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "04:41.47",
        CPU: "580.4",
        MEM: "6961K",
        PORT: "21",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "04:48.14",
        CPU: "615.6",
        MEM: "6977K",
        PORT: "21",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "04:54.94",
        CPU: "623.3",
        MEM: "7009K",
        PORT: "21",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "05:02.20",
        CPU: "666.9",
        MEM: "7025K",
        PORT: "21",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "05:08.78",
        CPU: "599.7",
        MEM: "7041K",
        PORT: "21",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "05:15.97",
        CPU: "657.7",
        MEM: "7057K",
        PORT: "21",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "05:23.03",
        CPU: "653.6",
        MEM: "7057K",
        PORT: "21",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "05:28.54",
        CPU: "508.2",
        MEM: "7057K",
        PORT: "21",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "05:33.85",
        CPU: "487.9",
        MEM: "7057K",
        PORT: "21",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "05:40.02",
        CPU: "553.7",
        MEM: "7057K",
        PORT: "21",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "05:47.02",
        CPU: "643.4",
        MEM: "7057K",
        PORT: "21",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "05:49.66",
        CPU: "242.6",
        MEM: "7057K",
        PORT: "21",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "05:53.42",
        CPU: "346.3",
        MEM: "7057K",
        PORT: "21",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "05:57.13",
        CPU: "330.1",
        MEM: "7057K",
        PORT: "21",
        STATE: "sleeping",
        _5: "",
      },
      {
        TIME: "05:57.13",
        CPU: "0.1",
        MEM: "7057K",
        PORT: "21",
        STATE: "sleeping",
        _5: "",
      },
    ];
    const node = [
      {
        TIME: "00:00.12",
        CPU: "0.0",
        MEM: "21M",
        PORT: "23",
        STATE: "sleeping",
        _5: "",
      },
      {
        TIME: "00:00.19",
        CPU: "3.2",
        MEM: "22M",
        PORT: "23",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "00:01.27",
        CPU: "99.4",
        MEM: "23M",
        PORT: "27",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "00:02.35",
        CPU: "99.3",
        MEM: "20M",
        PORT: "27",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "00:03.43",
        CPU: "99.5",
        MEM: "20M",
        PORT: "27",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "00:04.52",
        CPU: "100.3",
        MEM: "19M",
        PORT: "27",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "00:05.59",
        CPU: "98.9",
        MEM: "21M",
        PORT: "27",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "00:06.66",
        CPU: "98.9",
        MEM: "21M",
        PORT: "27",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "00:07.74",
        CPU: "98.9",
        MEM: "21M",
        PORT: "27",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "00:08.81",
        CPU: "97.4",
        MEM: "22M",
        PORT: "27",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "00:09.89",
        CPU: "99.0",
        MEM: "22M",
        PORT: "27",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "00:10.98",
        CPU: "98.8",
        MEM: "23M",
        PORT: "27",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "00:12.06",
        CPU: "98.9",
        MEM: "23M",
        PORT: "27",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "00:13.13",
        CPU: "98.9",
        MEM: "24M",
        PORT: "27",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "00:14.20",
        CPU: "97.7",
        MEM: "24M",
        PORT: "27",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "00:15.29",
        CPU: "99.1",
        MEM: "24M",
        PORT: "27",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "00:16.36",
        CPU: "99.0",
        MEM: "24M",
        PORT: "27",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "00:17.43",
        CPU: "98.7",
        MEM: "24M",
        PORT: "27",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "00:18.50",
        CPU: "98.6",
        MEM: "24M",
        PORT: "27",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "00:19.58",
        CPU: "99.1",
        MEM: "24M",
        PORT: "27",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "00:20.66",
        CPU: "99.1",
        MEM: "24M",
        PORT: "27",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "00:21.76",
        CPU: "99.0",
        MEM: "25M",
        PORT: "27",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "00:22.82",
        CPU: "98.3",
        MEM: "27M",
        PORT: "27",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "00:23.90",
        CPU: "99.0",
        MEM: "28M",
        PORT: "27",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "00:24.97",
        CPU: "98.5",
        MEM: "28M",
        PORT: "27",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "00:26.04",
        CPU: "99.2",
        MEM: "29M",
        PORT: "27",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "00:27.12",
        CPU: "99.1",
        MEM: "29M",
        PORT: "27",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "00:28.19",
        CPU: "98.8",
        MEM: "30M",
        PORT: "27",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "00:29.26",
        CPU: "98.4",
        MEM: "30M",
        PORT: "27",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "00:30.34",
        CPU: "98.8",
        MEM: "30M",
        PORT: "27",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "00:31.41",
        CPU: "99.0",
        MEM: "30M",
        PORT: "27",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "00:32.50",
        CPU: "98.6",
        MEM: "30M",
        PORT: "27",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "00:33.58",
        CPU: "99.0",
        MEM: "30M",
        PORT: "27",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "00:34.65",
        CPU: "98.8",
        MEM: "30M",
        PORT: "27",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "00:35.73",
        CPU: "99.0",
        MEM: "30M",
        PORT: "27",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "00:36.80",
        CPU: "98.5",
        MEM: "30M",
        PORT: "27",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "00:37.88",
        CPU: "100.4",
        MEM: "30M",
        PORT: "27",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "00:38.94",
        CPU: "95.6",
        MEM: "30M",
        PORT: "27",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "00:40.01",
        CPU: "99.1",
        MEM: "30M",
        PORT: "27",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "00:41.09",
        CPU: "99.1",
        MEM: "31M",
        PORT: "27",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "00:42.16",
        CPU: "98.4",
        MEM: "31M",
        PORT: "27",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "00:43.26",
        CPU: "98.9",
        MEM: "31M",
        PORT: "27",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "00:44.33",
        CPU: "98.6",
        MEM: "31M",
        PORT: "27",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "00:45.42",
        CPU: "99.1",
        MEM: "31M",
        PORT: "27",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "00:46.49",
        CPU: "99.0",
        MEM: "31M",
        PORT: "27",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "00:47.56",
        CPU: "99.0",
        MEM: "31M",
        PORT: "27",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "00:48.64",
        CPU: "98.9",
        MEM: "31M",
        PORT: "27",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "00:49.71",
        CPU: "99.0",
        MEM: "31M",
        PORT: "27",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "00:50.79",
        CPU: "99.4",
        MEM: "31M",
        PORT: "27",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "00:51.85",
        CPU: "98.2",
        MEM: "31M",
        PORT: "27",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "00:52.94",
        CPU: "100.0",
        MEM: "33M",
        PORT: "27",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "00:54.04",
        CPU: "98.9",
        MEM: "33M",
        PORT: "27",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "00:55.11",
        CPU: "99.1",
        MEM: "33M",
        PORT: "27",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "00:56.19",
        CPU: "99.4",
        MEM: "35M",
        PORT: "27",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "00:57.26",
        CPU: "98.8",
        MEM: "36M",
        PORT: "27",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "00:58.35",
        CPU: "100.1",
        MEM: "37M",
        PORT: "27",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "00:59.43",
        CPU: "98.3",
        MEM: "38M",
        PORT: "27",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "01:00.50",
        CPU: "98.7",
        MEM: "38M",
        PORT: "27",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "01:01.58",
        CPU: "99.0",
        MEM: "39M",
        PORT: "27",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "01:02.67",
        CPU: "100.8",
        MEM: "42M",
        PORT: "27",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "01:03.75",
        CPU: "99.2",
        MEM: "43M",
        PORT: "27",
        STATE: "running",
        _5: "",
      },
      {
        TIME: "01:04.45",
        CPU: "63.0",
        MEM: "43M",
        PORT: "27",
        STATE: "sleeping",
        _5: "",
      },
      {
        TIME: "01:04.45",
        CPU: "0.0",
        MEM: "43M",
        PORT: "27",
        STATE: "sleeping",
        _5: "",
      },
      {
        TIME: "01:04.45",
        CPU: "0.0",
        MEM: "43M",
        PORT: "27",
        STATE: "sleeping",
        _5: "",
      },
    ];
    const statLabels = Object.keys(rust[0])
      .map((k) => k)
      .filter((v) => !["_5", "STATE", "TIME"].includes(v));

    const timeLabels = rust.map((v) => dtoS(v.TIME));

    function chartLoaded(label, datasets) {
      console.log("loaded");
      var c = document.getElementById(label);
      var ctx = c.getContext("2d");
      const myChart = new Chart(ctx, {
        type: "line",
        data: {
          labels: timeLabels,
          datasets,
        },
      });
    }
    const datasets = statLabels.map((l) => {
      let _l = l;
      if (l === "MEM") _l = "Memory MB";
      if (l === "CPU") _l = "CPU %";
      const dataset = [
        {
          label: "Rust",
          data: rust.map((d) => {
            if (l === "TIME") {
              return dtoS(d[l]);
            }
            if (l === "MEM") {
              if (d[l].replaceAll(/[^a-zA-Z]/g, "") === "K") {
                return Number(d[l].replaceAll(/[a-zA-Z]/g, "")) * 0.001;
              }
              if (d[l].replaceAll(/[^a-zA-Z]/g, "") === "M") {
                return Number(d[l].replaceAll(/[a-zA-Z]/g, ""));
              }
            }
            return Number(d[l].replaceAll(/[a-zA-Z]/g, ""));
          }),
          //   fill: false,
          borderColor: "red",
          //   tension: 0.1,
        },
        {
          label: "Node",
          data: node.map((d) => {
            if (l === "TIME") {
              return dtoS(d[l]);
            }
            if (l === "MEM") {
              if (d[l].replaceAll(/[^a-zA-Z]/g, "") === "K") {
                return Number(d[l].replaceAll(/[a-zA-Z]/g, "")) * 0.001;
              }
              if (d[l].replaceAll(/[^a-zA-Z]/g, "") === "M") {
                return Number(d[l].replaceAll(/[a-zA-Z]/g, ""));
              }
            }
            return Number(d[l].replaceAll(/[a-zA-Z]/g, ""));
          }),

          //   fill: false,
          borderColor: "green",
          //   tension: 0.1,
        },
      ];
      console.log(dataset);
      chartLoaded(l, dataset);
    });
  </script>
</html>
